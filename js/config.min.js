var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,r){a.raw=r;return a};jQuery.noConflict();
(function(a,r){function w(b,c,d){var e=b||0,f=c||100,l=d||[];b={limit:f,offset:e};return kintone.api(kintone.api.url("/k/v1/apps",!0),"GET",b).then(function(m){l=l.concat(m.apps);return m.apps.length===f?w(e+f,f,l):l})}function A(b){b={app:b};return kintone.api(kintone.api.url("/k/v1/preview/form",!0),"GET",b).then(function(c){return c.properties})["catch"](function(c){console.log(c);return c})}function B(b){b={app:b};return kintone.api(kintone.api.url("/k/v1/app/views",!0),"GET",b).then(function(c){return kintone.Promise.resolve(c.views)})["catch"](function(c){console.log(c);
return kintone.Promise.reject(c)})}function x(b){var c=g.data.shadesInfo.selectedView,d=a("#select_shades_colors"),e=a("#checkbox_enable_shades_colors");g.data.shadesInfo[c].enable=e.prop("checked")?"1":"0";g.data.shadesInfo[c].fieldCode=d.val()===k.DEF_DROPDOWN_VALUE?"":d.val();g.data.shadesInfo[c].shades={};e=a("#tbody_shades > tr").length||0;for(var f=d=0;f<e;f++){var l=a("#tbody_shades > tr:eq("+f+") #select_operator").val(),m=a("#tbody_shades > tr:eq("+f+") .js-text-threshold").val(),p=a("#tbody_shades > tr:eq("+
f+") .js-text-polygon-fill-color").val();if(!b||""!==l&&""!==m&&""!==p)g.data.shadesInfo[c].shades["row"+d]=JSON.stringify({operator:l,threshold:m,fillColor:p}),d+=1}g.data.shadesInfo[c].shades.num=String(d);g.data.shadesInfo[c].info={};e=a("#tbody_info > tr").length||0;for(f=d=0;f<e;f++)if(l=a("#tbody_info > tr:eq("+f+") #select_info_field option:selected").text(),m=a("#tbody_info > tr:eq("+f+") #select_info_field").val(),!b||""!==l&&m!==k.DEF_DROPDOWN_VALUE)g.data.shadesInfo[c].info["row"+d]=JSON.stringify({fieldName:l,
fieldCode:m}),d+=1;g.data.shadesInfo[c].info.num=String(d)}function y(b){var c=a("#checkbox_enable_shades_colors"),d=a("#select_shades_colors");g.data.shadesInfo[b].fieldCode?d.val(g.data.shadesInfo[b].fieldCode):d.val(k.DEF_DROPDOWN_VALUE);a("#tbody_shades > tr:gt(0)").remove();a("#tbody_shades > tr:last-child #select_operator").val(">=");a("#tbody_shades > tr:last-child .js-text-threshold").val("");a("#tbody_shades > tr:last-child .js-text-polygon-fill-color").val(k.DEF_MAP_PROPERTY.polygon.fillColor);
a("#tbody_shades > tr:last-child #input_polygon_fill_color").val(k.DEF_MAP_PROPERTY.polygon.fillColor);if(g.data.shadesInfo[b].shades){d=Number(g.data.shadesInfo[b].shades.num)||0;for(var e=0;e<d;e++){var f=JSON.parse(g.data.shadesInfo[b].shades["row"+e]);0<e&&(a("#tbody_shades > tr").eq(0).clone(!0).insertAfter(a("#tbody_shades > tr:last-child")),q());a("#tbody_shades > tr:last-child #select_operator").val(f.operator);a("#tbody_shades > tr:last-child .js-text-threshold").val(f.threshold);a("#tbody_shades > tr:last-child .js-text-polygon-fill-color").val(f.fillColor);
a("#tbody_shades > tr:last-child #input_polygon_fill_color").val(f.fillColor)}}a("#tbody_info > tr:gt(0)").remove();a("#tbody_info > tr:last-child #select_info_field").val(k.DEF_DROPDOWN_VALUE);if(g.data.shadesInfo[b].info)for(d=Number(g.data.shadesInfo[b].info.num)||0,e=0;e<d;e++)f=JSON.parse(g.data.shadesInfo[b].info["row"+e]),0<e&&(a("#tbody_info > tr").eq(0).clone(!0).insertAfter(a("#tbody_info > tr:last-child")),q()),a("#tbody_info > tr:last-child #select_info_field").val(f.fieldCode);"1"===
g.data.shadesInfo[b].enable?(c.prop("checked",!0),a("#shades_colors_area").show()):(c.prop("checked",!1),a("#shades_colors_area").hide())}function C(){A(kintone.app.getId()).then(function(b){for(var c=0;c<b.length;c++){var d=b[c].type,e=b[c].label,f=b[c].code;"SINGLE_LINE_TEXT"===d&&a("#select_government_code").append(a("<option>").val(f).text(e+"("+f+")"));"NUMBER"===d&&a("#select_shades_colors").append(a("<option>").val(f).text(e+"("+f+")"));-1<k.INFO_FIELD_TYPE_ARRAY.indexOf(d)&&a("#select_info_field").append(a("<option>").val(f).text(e))}a("#select_government_code").prepend(a("<option>").val(k.DEF_DROPDOWN_VALUE).text(k.DEF_DROPDOWN_VALUE));
a("#select_shades_colors").prepend(a("<option>").val(k.DEF_DROPDOWN_VALUE).text(k.DEF_DROPDOWN_VALUE));a("#select_info_field").prepend(a("<option>").val(k.DEF_DROPDOWN_VALUE).text(k.DEF_DROPDOWN_VALUE));h.governmentCode&&a("#select_government_code").val(h.governmentCode)});w().then(function(b){for(var c=b.length-1;0<c;c--){var d=b[c],e=d.appId;d=d.name;a("#select_polygon_master").append(a("<option>").val(e).text(d))}a("#select_polygon_master").prepend(a("<option>").val(k.DEF_DROPDOWN_VALUE).text(k.DEF_DROPDOWN_VALUE));
h.polygonMasterAppId&&a("#select_polygon_master").val(h.polygonMasterAppId)});B(kintone.app.getId()).then(function(b){var c=!0,d;for(d in b)a("#select_map_view").append(a("<option>").val(b[d].id).text(b[d].name)),a("#select_embed_map_view").append(a("<option>").val(b[d].id).text(b[d].name)),g.data.shadesInfo[b[d].id]={viewName:b[d].name,enable:null,fieldCode:null,shades:null,info:null},c&&(g.data.shadesInfo.selectedView=b[d].id,c=!1);b=JSON.parse(h.shadesInfo);for(var e in b)e in g.data.shadesInfo&&
(g.data.shadesInfo[e]=b[e]);y(g.data.shadesInfo.selectedView)})}function D(){if(document.getElementById("error_text_zoom"))alert("\u4e0d\u6b63\u7b87\u6240\u304c\u3042\u308b\u305f\u3081\u5165\u529b\u3057\u306a\u304a\u3057\u3066\u304f\u3060\u3055\u3044\u3002");else{var b=a(".js-text-api-key"),c=a("#select_government_code"),d=a("#select_polygon_master"),e=a(".js-text-map-height"),f=a("#select_zoom"),l=a("#select_map_type"),m=a(".js-text-latitude"),p=a(".js-text-longitude"),t=a("#checkbox_select_position");
x(!0);if(!1!==E()){for(var u in h)delete h[u];h.apiKey=b.val();h.polygonMasterAppId=d.val();h.governmentCode=c.val()||"";h.mapHeight=e.val()||k.DEF_MAP_PROPERTY.height;h.zoom=f.val();h.mapType=l.val();h.selectPosition=t.prop("checked")?"1":"0";h.latitude=m.val()||"";h.longitude=p.val()||"";delete g.data.shadesInfo.selectedView;h.shadesInfo=JSON.stringify(g.data.shadesInfo);kintone.plugin.app.setConfig(h,function(){window.location.href="../../flow?app="+kintone.app.getId()})}}}function E(){console.log(g.data.shadesInfo);
for(var b in g.data.shadesInfo)if("selectedView"!==b){var c=g.data.shadesInfo[b].fieldCode;if("1"===g.data.shadesInfo[b].enable&&!c)return(new Kuc.Notification({text:"\u4e00\u89a7\u300c"+g.data.shadesInfo[b].viewName+"\u300d\u306e\u6fc3\u6de1\u3092\u5224\u5b9a\u3059\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044",type:"danger",duration:-1})).open(),!1}return!0}function z(b){var c=a(b).val();a("#error_text_zoom").remove();isNaN(c)?(c=a("<div>").attr("id",
"error_text_zoom").addClass("error-message").text("\u534a\u89d2\u6570\u5b57\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),a(b).before(c),a(b).focus()):Number.isInteger(Number(c))||(c=a("<div>").attr("id","error_text_zoom").addClass("error-message").text("\u6574\u6570\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),a(b).before(c),a(b).focus())}function v(b){var c=a(b).val();a("#error_text_zoom").remove();isNaN(c)&&(c=a("<div>").attr("id","error_text_zoom").addClass("error-message").text("\u534a\u89d2\u6570\u5b57\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),
a(b).before(c),a(b).focus())}function q(){1===a("#tbody_shades > tr").length?(a("#tbody_shades > tr .kintoneplugin-button-add-row-image").eq(0).show(),a("#tbody_shades > tr .kintoneplugin-button-remove-row-image").eq(0).hide()):(a("#tbody_shades > tr .kintoneplugin-button-remove-row-image").eq(0).show(),a("#tbody_shades > tr .kintoneplugin-button-remove-row-image").eq(1).show(),10<=a("#tbody_shades > tr").length?a("#tbody_shades > tr .kintoneplugin-button-add-row-image").hide():a("#tbody_shades > tr .kintoneplugin-button-add-row-image").show());
1===a("#tbody_info > tr").length?a("#tbody_info > tr .kintoneplugin-button-remove-row-image").eq(0).hide():(a("#tbody_info > tr .kintoneplugin-button-remove-row-image").eq(0).show(),a("#tbody_info > tr .kintoneplugin-button-remove-row-image").eq(1).show())}var k=window.GOOGLEMAPDEMO_COMMON||{},h=kintone.plugin.app.getConfig(r),g={data:{shadesInfo:{}}};a(document).ready(function(){var b=a("#save_btn"),c=a("#cancel_btn"),d=a(".js-text-api-key"),e=a(".js-text-map-height"),f=a("#select_zoom"),l=a("#select_map_type"),
m=a("#checkbox_select_position"),p=a(".js-text-latitude"),t=a(".js-text-longitude"),u=a("#select_map_view"),F=a("#select_embed_map_view"),G=a("#export_embed_tag"),H=a("#checkbox_enable_shades_colors");h.apiKey&&d.val(h.apiKey);h.mapHeight?e.val(h.mapHeight):e.val(k.DEF_MAP_PROPERTY.mapHeight);h.zoom?f.val(h.zoom):f.val(k.DEF_MAP_PROPERTY.zoom);h.mapType?l.val(h.mapType):l.val(k.DEF_MAP_PROPERTY.mapType);"1"===h.selectPosition?m.prop("checked",!0):m.prop("checked",!1);h.latitude&&p.val(h.latitude);
h.longitude&&t.val(h.longitude);u.on("change",function(){x(!1);var n=a("#select_map_view option:selected").val();g.data.shadesInfo.selectedView=n;y(g.data.shadesInfo.selectedView)});H.on("change",function(){a(this).prop("checked")?a("#shades_colors_area").show():a("#shades_colors_area").hide()});G.on("click",function(){var n=F.val(),I=kintone.app.getId();n='<iframe width="100%" height="400" frameborder="0" src='+(location.protocol+"//"+location.hostname+"/k/"+I+"/?view="+n+"&dashboard=true></iframe>");
a("#textarea_embed_code").val(n)});C();b.on("click",function(n){n.preventDefault();D()});c.on("click",function(){window.location.href="../../"+kintone.app.getId()+"/plugin/"})});a(".js-text-map-height").blur(function(){z(this)});a(".js-text-map-width").blur(function(){z(this)});a(".js-text-latitude").blur(function(){v(this)});a(".js-text-longitude").blur(function(){v(this)});a(".js-text-polygon-fill-color").on("change",function(){var b=a(this).val();a(this).closest("tr").find("#input_polygon_fill_color").val(b)});
a("#input_polygon_fill_color").on("change",function(){var b=a(this).val();a(this).closest("tr").find(".js-text-polygon-fill-color").val(b)});a(".js-text-polygon-fill-opacity").blur(function(){v(this)});a(".kintoneplugin-button-add-row-image").on("click",function(){var b=a(this).closest("tbody").attr("id");"tbody_shades"===b?(b=a("#tbody_shades > tr").eq(0).clone(!0),b.find("#select_operator").val(">="),b.find(".js-text-threshold").val(""),b.find(".js-text-polygon-fill-color").val(k.DEF_MAP_PROPERTY.polygon.fillColor),
b.find("#input_polygon_fill_color").val(k.DEF_MAP_PROPERTY.polygon.fillColor),b.insertAfter(a(this).parent().parent())):"tbody_info"===b&&a("#tbody_info > tr").eq(0).clone(!0).insertAfter(a(this).parent().parent());q()});a(".kintoneplugin-button-remove-row-image").on("click",function(){a(this).parent("td").parent("tr").remove();q()})})(jQuery,kintone.$PLUGIN_ID);